## REST API 성숙도 모델

![성숙도 모델.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/968ae027-00ab-446c-b5e9-dad9b8ef783f/%EC%84%B1%EC%88%99%EB%8F%84_%EB%AA%A8%EB%8D%B8.png)

REST API를 작성할 때는 몇 가지 지켜야 할 규칙들이 있다. 로이 필딩이 논문에서 제시한 REST 방법론을 보다 더 실용적으로 적용하기 위해 레오나르드 리차드슨은 REST API를 잘 적용하기 위한 4단계 모델을 만들었다.

이를 리차드슨의 REST 성숙도 모델이라 한다.

REST 성숙도 모델은 총 4단계(0~3단계)로 나누어진다.

3단계까지 모두 충족하는 것은 어렵다.

2단계 까지만 적용해도 좋은 API 디자인이라 볼 수 있다.

이런 경우 HTTP API라고도 부른다.

## REST 성숙도 모델 0단계

REST 성숙도 모델의 0단계에서는 단순히 HTTP 프로토콜을 사용하기만 해도 된다. 0단계는 좋은 REST API를 작성하기 위한 기본 단계이다.

다음과 같이 허준이라는 이름의 주치의의 예약 가능한 시간을 확인하고, 예약을 하는 상황을 예로 들어본다.

![성숙도 모델2.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4f9f228f-3ff6-4ad5-9660-ab0ed5b58bdd/%EC%84%B1%EC%88%99%EB%8F%84_%EB%AA%A8%EB%8D%B82.png)

위 예시에서는 HTTP 프로토콜을 사용하고 있다. 이렇게 단순히 HTTP 프로토콜을 사용하는 것이 REST API의 기본이다.

## REST 성숙도 모델 1단계

REST 성숙도 모델 1단계에서는 개별 리소스와의 통신을 준수해야 한다.

REST API는 웹에서 사용되는 모든 데이터나 자원(Resource)을 HTTP URI로 표현한다.

따라서 모든 자원은 개별 리소스에 맞는 엔드포인트(Endpoint)를 사용해야 한다는 것과 요청하고 받은 자원에 대한 정보를 응답으로 전달해야 한다는 것이 1단계에서 이루어져야 한다.

앞서 0단계에서는 모든 요청을 엔드포인트로 /appointment를 사용한다. 하지만, 1단계에서는 요청하는 리소스가 무엇인지에 따라 각기 다른 엔드포인트로 구분하여 사용해야 한다.

![성숙도 모델3.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c475db8a-a0a9-43a8-bced-a3ca9080edb5/%EC%84%B1%EC%88%99%EB%8F%84_%EB%AA%A8%EB%8D%B83.png)

예약 가능한 시간 확인을 위한 요청의 응답으로 받게되는 자원(Resource)은 허준이라는 의사의 예약 가능한 시간대이다.

따라서 /doctor/허준이라는 엔드포인트를 사용한다. 뿐만 아니라 특정 시간에 예약을 하게 되면, 실제 slots라는 리소스의 123이라는 id를 가진 리소스가 변경되기 때문에, 하단의 특정 시간에 예약이라는 요청에서는 /slots/123 으로 실제 변경되는 리소스를 엔트포인트로 사용한다.

위 예시와 같이 어떤 리소스를 변화시키는지 혹은 어떤 응답이 제공되는지에 따라 각기 다른 엔드포인트를 사용하기 때문에, 적절한 엔드포인트를 작성하는 것이 중요하다.

엔드포인트 작성할 때는 동사, HTTP 메서드, 혹은 어떤 행위에 대한 단어 사용은 지양하고,

리소스에 집중해 명사 형태의 단어로 작성하는 것이 바람직하다.

응답으로 리소스를 전할 때에도 리소스에 대한 정보와 함께 리소스 사용에 대한 성공/실패 여주를 반환해야 한다. 예를 들어 환자가 허준 의사에게 9시 예약을 진행하였으나 해당 시간이 마감되어 예약이 불가능 하다면, 다음과 같이 리소스 사용에 대한 실패 여부를 포함한 응답을 받아야 한다.

![성숙도 모델4.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/db592a54-f414-4e33-8fb4-b4de5f03db29/%EC%84%B1%EC%88%99%EB%8F%84_%EB%AA%A8%EB%8D%B84.png)

## REST 성숙도 모델 - 2단계

REST 성숙도 모델 2단계에서는 CRUD에 맞게 적절한 HTTP 메서드를 사용하는 것에 중점을 둔다.

위 0단계와 1단계 예시에서는 모든 요청을 POST로 하고 있으나, REST 성숙도 모델 2단계에서는 CRUD에 따른 적합한 메서드를 사용한 것이 아니다.

먼저 예약 가능한 시간을 확인한다는 것은 예약 가능한 시간을 조회(READ)하는 행위를 의미한다.

특정 시간에 예약한다는 것은 해당 시간에 예약을 생성(CREAT)한다는 것과 같다.

따라서 조회(READ)를 하기 위해서는 GET 메서드를 사용하여 요청을 하는 것이 바람직 하며, GET 메서드는 body를 가지지 않기 때문에 query parameter를 사용하여 필요한 리소스를 전달한다.

다음으로 예약을 생성(CREAT) 하기 위해서는 POST 메서드를 사용하여 요청을 보내는 것이 바람직하다. 또한, POST 요청에 대한 응답이 어떻게 반환되는지도 중요하다.

이 경우, 응답은 새롭게 생성된 리소스를 보내주기 위해 응답 코드도 202 Created로 명확하게 작성해야 하며, 관련 리소스를 클라이언트가 Location 헤더에 작성된 URI를 통해 확인할 수 있도록 해야 REST 성숙도 모델의 2단계를 충족한 것으로 볼 수 있다.

![성숙도 모델5.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/44c5a4ec-604b-4ad8-a759-9997ed06a66d/%EC%84%B1%EC%88%99%EB%8F%84_%EB%AA%A8%EB%8D%B85.png)

**HTTP 메서드 사용 규칙**

GET : 서버의 데이터를 변화시키지 않는 요청에 사용해야 한다. GET 메서드는 지정된 리소스의 표현을 요청한다.

POST : 요청마다 새로운 리소스를 생성해야 한다. 주로 데이터 등록에 사용한다.

PUT : 같은 리소스를 반환해야 하며, 없으면 새롭게 생성한다. (멱등성)

PATCH : 리소스의 수정(부분 변경) 용도로 사용해야 한다.

HEAD : GET 요청과 동일한 응답을 요청하나 응답 시 body를 포함하지 않는다.

DELETE : 지정된 리소스를 삭제한다.

CONNECT : 리소스에 의해 식별된 서버에 대한 터널을 설정한다.

OPTIONS : 리소스에 대한 통신 옵션을 설명한다.

TRACE : 리소스에 대한 경로를 따라 메시지 루프백(loop-back) 테스트를 수행하낟.

일반적으로 REST 성숙도 모델 2단계를 잘 적용하면 대체로 잘 작성된 API라고 여긴다. 이를 HTTP API라고도 한다.

즉, REST 성숙도 모델 3단계까지 무조건적으로 적용해야 하는 것은 아니기도 하다.

## REST 성숙도 모델 3단계

마지막 3단계는 HATEOAS(Hypertext As The Engine Of Application State)라고 불리는 하이퍼미디어 컨트롤을 적용한다.

**HATEOAS(헤이티오스)**

HATEOAS는 REST 아키텍처의 한 구성 요소로 애플리케이션의 상태를 전이할 수 있는 메커니즘을 제공할 수 있다.

REST API를 사용하는 클라이언트가 서버와 동적인 상호작용이 가능하도록 하는 것을 의미하고 클라이언트가 서버로부터 어떠한 요청을 할 때, 요청에 필요한 URI를 응답에 포함시켜 반환하는 것을 가능하게 한다.

3단계의 요청은 2단계와 동일하지만, 응답에는 리소스의 URI를 포함한 링크 요소를 삽입하여 작성한다는 것이 다르다.

이때 응답에 들어가게 되는 링크 요소는 응답을 받은 다음에 할 수 있는 다양한 액션덜을 위해 많은 하이퍼미디어 컨트롤을 포함하고 있다.

![성숙도 모델 6.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/ade79593-7a69-42d4-943a-4d5858f47bf7/%EC%84%B1%EC%88%99%EB%8F%84_%EB%AA%A8%EB%8D%B8_6.png)

예를 들어 허준이라는 의사의 예약 가능한 시간을 확인한 후, 그 시간대에 예약을 할 수 있는 링크를 삽입하거나, 특정 시간에 예약을 완료하고 나서 해당 예약을 다시 확인할 수 있도록 링크를 작성해 넣을 수 있다.

이렇게 응답 내에 새로운 링크를 넣어 새로운 기능에 접근할 수 있도록 하는 것이 3단계의 핵심이다.